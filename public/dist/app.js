function e(){$.ajax({type:"GET",url:"../api/beneficios",dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){$("#d-content").hide(),$("#d-content").html(e.html).fadeIn(),$("#listado-beneficios").DataTable({responsive:!0,columnDefs:[{orderable:!1,targets:[6,7]}],order:[],language:{decimal:"",emptyTable:"No se encontraron resultados",info:"Mostrando _START_ a _END_ de un total de _TOTAL_ entradas",infoEmpty:"Mostrando 0 a 0 de 0 entradas",infoFiltered:"(filtrado de un total de _MAX_ entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordenar columnas de forma acsendente",sortDescending:": activar para ordenar columnas de forma descendente"}}}),$(".modify").click(function(){o($(this).attr("data-val"))}),$(".view").click(function(){var e=$(this).attr("data-val");t(e)}),$(".reject").click(function(){a($(this).attr("data-val"))}),$("#new-button").click(function(){n()}),m()}})}function t(t){$.ajax({type:"GET",url:"../api/beneficios/"+t,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(a){$("#d-content").hide(),$("#d-content").html(a.html).fadeIn(),$("#btn-add").click(function(){r(t)}),$("#btn-end").click(function(){l(t)}),$(".btn-back").click(function(){e()})}})}function a(t){$.ajax({type:"POST",url:"../api/beneficios/rechazar/"+t,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(t){"success"==t.status?(g(t.status,t.message.title,t.message.body,t.message.timeout),e()):g(t.status,t.message.title,t.message.body,t.message.timeout)}})}function n(){$.ajax({type:"GET",url:"../api/beneficios/create/new",dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(t){$("#d-content").hide(),$("#d-content").html(t.html).fadeIn(),m(),$("#create-button").click(function(){s()}),$(".btn-back").click(function(){e()})}})}function o(t){$.ajax({type:"GET",url:"../api/beneficios/edit/"+t,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(a){$("#d-content").hide(),$("#d-content").html(a.html).fadeIn(),m(),$("#modify-button").click(function(){c(t)}),$(".btn-back").click(function(){e()})}})}function s(){if(b($("#user-rut")[0])){var t={rut:$("#user-rut").val(),nombre:$("#user-name").val(),tipo:$("#benefit-type").val(),empresa:$("#user-company").val()};$.ajax({type:"POST",url:"../api/beneficios/store",data:t,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(t){"success"==t.status?(g(t.status,t.message.title,t.message.body,t.message.timeout),e()):g(t.status,t.message.title,t.message.body,t.message.timeout)}})}else g("error","","El rut no es válido",2)}function c(t){var a={id:t,nombre:$("#user-name").val(),estado:$("#benefit-status").val(),tipo:$("#benefit-type").val(),empresa:$("#user-company").val()};$.ajax({type:"POST",url:"../api/beneficios/update",data:a,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(t){"success"==t.status?(g(t.status,t.message.title,t.message.body,t.message.timeout),e()):g(t.status,t.message.title,t.message.body,t.message.timeout)}})}function r(e){$.ajax({type:"GET",url:"../api/hitos/"+e,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(a){$("#d-content").hide(),$("#d-content").html(a.html).fadeIn(),m(),$("#create-button").click(function(){u(e)});$("#hito-date").pickadate({format:"dd/mm/yyyy",format_submit:!1,closeOnSelect:!1,closeOnClear:!1}).pickadate("picker");$(".btn-back").click(function(){t(e)}),$("#hito-date").click(function(){$(this).parents(".form-input").find("label").addClass("active-input")})}})}function u(e){var t={ben_id:e,hito_id:$("#hito").val(),detalle:$("#observation").val(),fecha:$("#hito-date").val()};$.ajax({type:"POST",url:"../api/hitos/store",data:t,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(t){"success"==t.status?(g(t.status,t.message.title,t.message.body,t.message.timeout),r(e)):g(t.status,t.message.title,t.message.body,t.message.timeout)}})}function l(e){$.ajax({type:"POST",url:"../api/etapa/finalizar/"+e,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(a){"success"==a.status?(g(a.status,a.message.title,a.message.body,a.message.timeout),t(e)):g(a.status,a.message.title,a.message.body,a.message.timeout)}})}function f(){$.ajax({type:"GET",url:"../api/usuario/edit",dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){$("#d-content").hide(),$("#d-content").html(e.html).fadeIn(),m(),$("#create-button").click(function(){d()})}})}function d(){var t={pass:$("#pass").val(),newpass1:$("#newpass1").val(),newpass2:$("#newpass2").val()};$.ajax({type:"POST",url:"../api/usuario/update",data:t,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(t){if("success"==t.status){g(t.status,t.message.title,t.message.body,t.message.timeout),e();var a=$(".navbar").children();a.removeClass("nav-element-active"),a.first().addClass("nav-element-active")}else g(t.status,t.message.title,t.message.body,t.message.timeout)}})}function t(){if(b($("#user-rut")[0])){var e=$("#user-rut").val(),t=$("#user-company").val();$.ajax({type:"GET",url:"api/consulta/"+t+"/"+e,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){"error"==e.status?g(e.status,e.message.title,e.message.body,e.message.timeout):($(document).off("keypress"),$("#d-content").hide(),$("body").scrollTop(),$("#d-content").html(e.html).fadeIn())}})}else g("error","","El rut no es válido",2)}function m(){$("input, textarea").focusin(function(){$(this).parents(".form-input").find("label").addClass("active-input")}),$("input, textarea").off("focusin"),$("input, textarea").focusin(function(){$(this).parents(".form-input").find("label").addClass("active-input")}),$("input, textarea").off("focusout"),$("input, textarea").focusout(function(){var e=$(this).parents(".form-input").find("label");"hito-date"!=this.id&&""==$(this).val()&&e.hasClass("active-input")&&e.removeClass("active-input")}),$("input, textarea").each(function(e){""!=$(this).val()&&$(this).parents(".form-input").find("label").addClass("active-input")}),$("select").each(function(e){$(this).parents(".form-input").find("label").addClass("active-input")}),$("textarea").each(function(e){$(this).parents(".form-input").find("label").addClass("label-select")})}function p(){var t=$(".navbar").children();t.click(function(){t.removeClass("nav-element-active"),$(this).addClass("nav-element-active")}),$("#main-title").text("Beneficios habitacionales"),$("#beneficios-nav").click(function(){e(),$("#main-title").text("Beneficios habitacionales")}),$("#salir-nav").click(function(){h(),$("#main-title").text("Hasta pronto!")}),$("#cuenta-nav").click(function(){f(),$("#main-title").text("Gestión de cuenta")}),$("#main-title").text("Beneficios habitacionales")}function h(){$.ajax({type:"POST",url:"../api/logout",dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){"success"==e.status&&(window.location.href="../login/")}})}function g(e,t,a,n){var o=$(".d-toast").length,s="";switch(e){case"success":s=" d-toast-success";break;case"error":s=" d-toast-error";break;case"notify":s=" d-toast-notify";break;case"warning":s=" d-toast-warning"}var i="";i+='<div id="toast_'+o+'" class="d-toast fadeInTop'+s+'">',i+="<strong>"+t+"</strong>",i+=" "+a+".",i+="</div>",$("body").append(i),$("#toast_"+o).show();var c=80+50*o;$("#toast_"+o).css("top",c),setTimeout(function(){$("#toast_"+o).removeClass("fadeInTop"),$("#toast_"+o).addClass("fadeOutTop"),setTimeout(function(){$("#toast_"+o).remove()},500)},1e3*n)}function b(e){var t=e.value,a="";for(i=0;i<t.length;i++)" "!=t.charAt(i)&&"."!=t.charAt(i)&&"-"!=t.charAt(i)&&(a+=t.charAt(i));if(t=a,largo=t.length,""!=t&&largo<8)return!1;for(i=0;i<largo;i++)if("0"!=t.charAt(i)&&"1"!=t.charAt(i)&&"2"!=t.charAt(i)&&"3"!=t.charAt(i)&&"4"!=t.charAt(i)&&"5"!=t.charAt(i)&&"6"!=t.charAt(i)&&"7"!=t.charAt(i)&&"8"!=t.charAt(i)&&"9"!=t.charAt(i)&&"k"!=t.charAt(i)&&"K"!=t.charAt(i))return e.focus(),e.select(),!1;var n="";for(i=largo-1,j=0;i>=0;i--,j++)n+=t.charAt(i);var o="";for(o+=n.charAt(0),o+="-",cnt=0,i=1,j=2;i<largo;i++,j++)3==cnt?(o+=".",j++,o+=n.charAt(i),cnt=1):(o+=n.charAt(i),cnt++);for(n="",i=o.length-1,j=0;i>=0;i--,j++)n+=o.charAt(i);return e.value=n.toUpperCase(),v(e,t)}function v(e,t){"-"==e.value&&(e.value="");var a,n,o;if((a=t.length)<8&&a>3)return!1;if(n=a>2?t.substring(0,a-1):t.charAt(0),o=t.charAt(a-1),null==n||null==o)return!0;if(""==n||""==o)return!0;var s="0";for(suma=0,mul=2,i=n.length-1;i>=0;i--)suma+=n.charAt(i)*mul,7==mul?mul=2:mul++;return res=suma%11,1==res?s="k":0==res?s="0":(dvi=11-res,s=dvi+""),s==o.toLowerCase()}function y(e){if(""!=e){for(var t,a,n,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="",i=0,c=e.length;i<c;){if(t=255&e.charCodeAt(i++),i==c){s+=o.charAt(t>>2),s+=o.charAt((3&t)<<4),s+="==";break}if(a=e.charCodeAt(i++),i==c){s+=o.charAt(t>>2),s+=o.charAt((3&t)<<4|(240&a)>>4),s+=o.charAt((15&a)<<2),s+="=";break}n=e.charCodeAt(i++),s+=o.charAt(t>>2),s+=o.charAt((3&t)<<4|(240&a)>>4),s+=o.charAt((15&a)<<2|(192&n)>>6),s+=o.charAt(63&n)}return s}return!1}$(document).ready(function(){e(),p()}),$(document).ready(function(){m(),$("#send-button").click(function(){t()}),$("#user-rut").focus(),$(document).keypress(function(e){13==(e.keyCode||e.which)&&t()})}),$(document).ready(function(){function e(){if(b($("#rut-user")[0])){if(""!=$("#pass-user").val())e=y($("#pass-user").val());else var e="";var t={rut:$("#rut-user").val(),pass:e};$.ajax({type:"POST",url:"../api/login",data:t,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){"success"==e.status?($(document).off("keypress"),g(e.status,e.message.title,e.message.body,e.message.timeout),window.location.href="../admin/"):g(e.status,e.message.title,e.message.body,e.message.timeout)}})}else g("error","","El rut no es válido",2)}$("#rut-user").focus(),$(document).keypress(function(t){13==(t.keyCode||t.which)&&e()}),$("#login-button").on("click",e)});