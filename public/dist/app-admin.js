function t(){$.ajax({type:"GET",url:"../api/beneficios",dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(t){$("#d-content").hide(),$("#d-content").html(t.html).fadeIn(),$("#listado-beneficios").DataTable({responsive:!0,columnDefs:[{orderable:!1,targets:[6,7]}],order:[],language:{decimal:"",emptyTable:"No se encontraron resultados",info:"Mostrando _START_ a _END_ de un total de _TOTAL_ entradas",infoEmpty:"Mostrando 0 a 0 de 0 entradas",infoFiltered:"(filtrado de un total de _MAX_ entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordenar columnas de forma acsendente",sortDescending:": activar para ordenar columnas de forma descendente"}}}),$(".modify").click(function(){o($(this).attr("data-val"))}),$(".view").click(function(){e($(this).attr("data-val"))}),$(".reject").click(function(){a($(this).attr("data-val"))}),$("#new-button").click(function(){n()}),m()}})}function e(e){$.ajax({type:"GET",url:"../api/beneficios/"+e,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(a){$("#d-content").hide(),$("#d-content").html(a.html).fadeIn(),$("#btn-add").click(function(){r(e)}),$("#btn-end").click(function(){l(e)}),$(".btn-back").click(function(){t()})}})}function a(e){$.ajax({type:"POST",url:"../api/beneficios/rechazar/"+e,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){"success"==e.status?(g(e.status,e.message.title,e.message.body,e.message.timeout),t()):g(e.status,e.message.title,e.message.body,e.message.timeout)}})}function n(){$.ajax({type:"GET",url:"../api/beneficios/create/new",dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){$("#d-content").hide(),$("#d-content").html(e.html).fadeIn(),m(),$("#create-button").click(function(){s()}),$(".btn-back").click(function(){t()})}})}function o(e){$.ajax({type:"GET",url:"../api/beneficios/edit/"+e,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(a){$("#d-content").hide(),$("#d-content").html(a.html).fadeIn(),m(),$("#modify-button").click(function(){c(e)}),$(".btn-back").click(function(){t()})}})}function s(){if(b($("#user-rut")[0])){var e={rut:$("#user-rut").val(),nombre:$("#user-name").val(),tipo:$("#benefit-type").val(),empresa:$("#user-company").val()};$.ajax({type:"POST",url:"../api/beneficios/store",data:e,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){"success"==e.status?(g(e.status,e.message.title,e.message.body,e.message.timeout),t()):g(e.status,e.message.title,e.message.body,e.message.timeout)}})}else g("error","","El rut no es válido",2)}function c(e){var a={id:e,nombre:$("#user-name").val(),estado:$("#benefit-status").val(),tipo:$("#benefit-type").val(),empresa:$("#user-company").val()};$.ajax({type:"POST",url:"../api/beneficios/update",data:a,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){"success"==e.status?(g(e.status,e.message.title,e.message.body,e.message.timeout),t()):g(e.status,e.message.title,e.message.body,e.message.timeout)}})}function r(t){$.ajax({type:"GET",url:"../api/hitos/"+t,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(a){$("#d-content").hide(),$("#d-content").html(a.html).fadeIn(),m(),$("#create-button").click(function(){u(t)});$("#hito-date").pickadate({format:"dd/mm/yyyy",format_submit:!1,closeOnSelect:!1,closeOnClear:!1}).pickadate("picker");$(".btn-back").click(function(){e(t)}),$("#hito-date").click(function(){$(this).parents(".form-input").find("label").addClass("active-input")})}})}function u(t){var e={ben_id:t,hito_id:$("#hito").val(),detalle:$("#observation").val(),fecha:$("#hito-date").val()};$.ajax({type:"POST",url:"../api/hitos/store",data:e,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){"success"==e.status?(g(e.status,e.message.title,e.message.body,e.message.timeout),r(t)):g(e.status,e.message.title,e.message.body,e.message.timeout)}})}function l(t){$.ajax({type:"POST",url:"../api/etapa/finalizar/"+t,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(a){"success"==a.status?(g(a.status,a.message.title,a.message.body,a.message.timeout),e(t)):g(a.status,a.message.title,a.message.body,a.message.timeout)}})}function f(){$.ajax({type:"GET",url:"../api/usuario/edit",dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(t){$("#d-content").hide(),$("#d-content").html(t.html).fadeIn(),m(),$("#create-button").click(function(){d()})}})}function d(){var e={pass:$("#pass").val(),newpass1:$("#newpass1").val(),newpass2:$("#newpass2").val()};$.ajax({type:"POST",url:"../api/usuario/update",data:e,dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(e){if("success"==e.status){g(e.status,e.message.title,e.message.body,e.message.timeout),t();var a=$(".navbar").children();a.removeClass("nav-element-active"),a.first().addClass("nav-element-active")}else g(e.status,e.message.title,e.message.body,e.message.timeout)}})}function m(){$("input, textarea").focusin(function(){$(this).parents(".form-input").find("label").addClass("active-input")}),$("input, textarea").off("focusin"),$("input, textarea").focusin(function(){$(this).parents(".form-input").find("label").addClass("active-input")}),$("input, textarea").off("focusout"),$("input, textarea").focusout(function(){var t=$(this).parents(".form-input").find("label");"hito-date"!=this.id&&""==$(this).val()&&t.hasClass("active-input")&&t.removeClass("active-input")}),$("input, textarea").each(function(t){""!=$(this).val()&&$(this).parents(".form-input").find("label").addClass("active-input")}),$("select").each(function(t){$(this).parents(".form-input").find("label").addClass("active-input")}),$("textarea").each(function(t){$(this).parents(".form-input").find("label").addClass("label-select")})}function p(){var e=$(".navbar").children();e.click(function(){e.removeClass("nav-element-active"),$(this).addClass("nav-element-active")}),$("#main-title").text("Beneficios habitacionales"),$("#beneficios-nav").click(function(){t(),$("#main-title").text("Beneficios habitacionales")}),$("#salir-nav").click(function(){h(),$("#main-title").text("Hasta pronto!")}),$("#cuenta-nav").click(function(){f(),$("#main-title").text("Gestión de cuenta")}),$("#main-title").text("Beneficios habitacionales")}function h(){$.ajax({type:"POST",url:"../api/logout",dataType:"json",beforeSend:function(){$("#floating-loader").fadeIn(200)},complete:function(){$("#floating-loader").fadeOut(200)},success:function(t){"success"==t.status&&(window.location.href="../login/")}})}function g(t,e,a,n){var i=$(".d-toast").length,o="";switch(t){case"success":o=" d-toast-success";break;case"error":o=" d-toast-error";break;case"notify":o=" d-toast-notify";break;case"warning":o=" d-toast-warning"}var s="";s+='<div id="toast_'+i+'" class="d-toast fadeInTop'+o+'">',s+="<strong>"+e+"</strong>",s+=" "+a+".",s+="</div>",$("body").append(s),$("#toast_"+i).show();var c=80+50*i;$("#toast_"+i).css("top",c),setTimeout(function(){$("#toast_"+i).removeClass("fadeInTop"),$("#toast_"+i).addClass("fadeOutTop"),setTimeout(function(){$("#toast_"+i).remove()},500)},1e3*n)}function b(t){var e=t.value,a="";for(i=0;i<e.length;i++)" "!=e.charAt(i)&&"."!=e.charAt(i)&&"-"!=e.charAt(i)&&(a+=e.charAt(i));if(e=a,largo=e.length,""!=e&&largo<8)return!1;for(i=0;i<largo;i++)if("0"!=e.charAt(i)&&"1"!=e.charAt(i)&&"2"!=e.charAt(i)&&"3"!=e.charAt(i)&&"4"!=e.charAt(i)&&"5"!=e.charAt(i)&&"6"!=e.charAt(i)&&"7"!=e.charAt(i)&&"8"!=e.charAt(i)&&"9"!=e.charAt(i)&&"k"!=e.charAt(i)&&"K"!=e.charAt(i))return t.focus(),t.select(),!1;var n="";for(i=largo-1,j=0;i>=0;i--,j++)n+=e.charAt(i);var o="";for(o+=n.charAt(0),o+="-",cnt=0,i=1,j=2;i<largo;i++,j++)3==cnt?(o+=".",j++,o+=n.charAt(i),cnt=1):(o+=n.charAt(i),cnt++);for(n="",i=o.length-1,j=0;i>=0;i--,j++)n+=o.charAt(i);return t.value=n.toUpperCase(),v(t,e)}function v(t,e){"-"==t.value&&(t.value="");var a,n,o;if((a=e.length)<8&&a>3)return!1;if(n=a>2?e.substring(0,a-1):e.charAt(0),o=e.charAt(a-1),null==n||null==o)return!0;if(""==n||""==o)return!0;var s="0";for(suma=0,mul=2,i=n.length-1;i>=0;i--)suma+=n.charAt(i)*mul,7==mul?mul=2:mul++;return res=suma%11,1==res?s="k":0==res?s="0":(dvi=11-res,s=dvi+""),s==o.toLowerCase()}function y(t){if(""!=t){for(var e,a,n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="",s=0,c=t.length;s<c;){if(e=255&t.charCodeAt(s++),s==c){o+=i.charAt(e>>2),o+=i.charAt((3&e)<<4),o+="==";break}if(a=t.charCodeAt(s++),s==c){o+=i.charAt(e>>2),o+=i.charAt((3&e)<<4|(240&a)>>4),o+=i.charAt((15&a)<<2),o+="=";break}n=t.charCodeAt(s++),o+=i.charAt(e>>2),o+=i.charAt((3&e)<<4|(240&a)>>4),o+=i.charAt((15&a)<<2|(192&n)>>6),o+=i.charAt(63&n)}return o}return!1}$(document).ready(function(){t(),p()});